
    <!DOCTYPE html>
    <html>
    <head>
        <title>Nearest Metro Stations & POIs</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
        <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
        <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
        <style>
            body { margin: 0; padding: 0; }
            #map {
                width: 100%;
                height: 600px;
                position: relative;
                transform: translateZ(0);
                will-change: transform;
            }
            .leaflet-popup-content {
                padding: 15px;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            }
            .station-popup {
                font-family: Arial, sans-serif;
            }
            .station-name {
                font-weight: bold;
                font-size: 1.1em;
                margin-bottom: 8px;
                color: #333;
            }
            .station-info {
                color: #666;
                font-size: 0.9em;
                line-height: 1.4;
            }
            .loading {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                z-index: 1000;
                background: rgba(255, 255, 255, 0.9);
                padding: 20px;
                border-radius: 5px;
                box-shadow: 0 0 10px rgba(0,0,0,0.1);
            }
            .leaflet-control-zoom {
                border-radius: 4px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            }
            .leaflet-control-zoom a {
                width: 30px;
                height: 30px;
            }
            .legend {
                position: absolute;
                bottom: 20px;
                right: 20px;
                background: white;
                padding: 10px;
                border-radius: 4px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                z-index: 1000;
            }
            .legend-item {
                margin: 5px 0;
                display: flex;
                align-items: center;
            }
            .legend-color {
                width: 12px;
                height: 12px;
                border-radius: 50%;
                margin-right: 8px;
            }
        </style>
    </head>
    <body>
        <div id="map"></div>
        <div id="loading" class="loading" style="display: none;">Loading...</div>
        
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
        <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
        <script>
            // Debounce function
            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
            
            // Initialize map
            const map = L.map('map', {
                center: [12.896373, 77.496918],
                zoom: 13,
                zoomControl: false,
                attributionControl: true
            });
            
            // Add tile layer
            L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
                maxZoom: 18,
                minZoom: 10
            }).addTo(map);
            
            // Add zoom control
            L.control.zoom({
                position: 'topright'
            }).addTo(map);
            
            // Add user location marker
            const userMarker = L.marker([12.896373, 77.496918], {
                icon: L.divIcon({
                    className: 'user-location',
                    html: '<div style="background-color: #3388ff; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 4px rgba(0,0,0,0.3);"></div>'
                })
            }).addTo(map);
            
            // Add station markers
            const stations = {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"name": "Kengeri Bus Terminal", "line": "Purple Line", "distance": 4521, "duration": 3253, "type": "metro"}, "geometry": {"type": "Point", "coordinates": [77.4875516, 12.9145367]}}]};
            const markers = L.markerClusterGroup({
                maxClusterRadius: 50,
                disableClusteringAtZoom: 17,
                chunkedLoading: true
            });
            
            // Custom icons for different POI types
            const icons = {
                metro: L.divIcon({
                    className: 'metro-icon',
                    html: '<div style="background-color: #e41a1c; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 4px rgba(0,0,0,0.3);"></div>'
                }),
                bus_station: L.divIcon({
                    className: 'bus-icon',
                    html: '<div style="background-color: #377eb8; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 4px rgba(0,0,0,0.3);"></div>'
                }),
                taxi: L.divIcon({
                    className: 'taxi-icon',
                    html: '<div style="background-color: #4daf4a; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 4px rgba(0,0,0,0.3);"></div>'
                }),
                fuel: L.divIcon({
                    className: 'fuel-icon',
                    html: '<div style="background-color: #ff7f00; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 4px rgba(0,0,0,0.3);"></div>'
                })
            };
            
            // Add markers to cluster group
            stations.features.forEach(feature => {
                const marker = L.marker([
                    feature.geometry.coordinates[1],
                    feature.geometry.coordinates[0]
                ], {
                    icon: icons[feature.properties.type] || icons.metro
                });
                
                let popupContent = `
                    <div class="station-popup">
                        <div class="station-name">${feature.properties.name}</div>
                        <div class="station-info">
                `;
                
                if (feature.properties.type === 'metro') {
                    popupContent += `
                            Line: ${feature.properties.line}<br>
                    `;
                }
                
                popupContent += `
                            Distance: ${feature.properties.distance}m<br>
                            Walking time: ${formatDuration(feature.properties.duration)}
                        </div>
                    </div>
                `;
                
                marker.bindPopup(popupContent);
                markers.addLayer(marker);
            });
            
            // Add cluster group to map
            map.addLayer(markers);
            
            // Add legend
            const legend = L.control({ position: 'bottomright' });
            legend.onAdd = function(map) {
                const div = L.DomUtil.create('div', 'legend');
                div.innerHTML = `
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #e41a1c;"></div>
                        Metro Station
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #377eb8;"></div>
                        Bus Station
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #4daf4a;"></div>
                        Taxi Stand
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #ff7f00;"></div>
                        Fuel Station
                    </div>
                `;
                return div;
            };
            legend.addTo(map);
            
            // Helper function to format duration
            function formatDuration(seconds) {
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                if (minutes === 0) return `${remainingSeconds} sec`;
                if (remainingSeconds === 0) return `${minutes} min`;
                return `${minutes} min ${remainingSeconds} sec`;
            }
            
            // Show loading indicator during heavy operations
            function showLoading() {
                document.getElementById('loading').style.display = 'block';
            }
            
            function hideLoading() {
                document.getElementById('loading').style.display = 'none';
            }
            
            // Optimized event handlers
            const debouncedMoveEnd = debounce(() => {
                // Handle map move end event
            }, 250);
            
            const debouncedZoomEnd = debounce(() => {
                // Handle zoom end event
            }, 250);
            
            map.on('moveend', debouncedMoveEnd);
            map.on('zoomend', debouncedZoomEnd);
        </script>
    </body>
    </html>
    